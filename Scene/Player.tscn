[gd_scene load_steps=48 format=3 uid="uid://i6gs5jfo8l7k"]

[ext_resource type="Texture2D" uid="uid://h2qialduihx4" path="res://Asset/Sprite/FreeKnight_v1/Colour1/NoOutline/120x80_PNGSheets/_Idle.png" id="1_6l3be"]
[ext_resource type="Texture2D" uid="uid://nj8tgxpjg3xf" path="res://Asset/Sprite/FreeKnight_v1/Colour1/NoOutline/120x80_PNGSheets/_Crouch.png" id="1_fvocf"]
[ext_resource type="Texture2D" uid="uid://dngir4uw4ogag" path="res://Asset/Sprite/FreeKnight_v1/Colour1/NoOutline/120x80_PNGSheets/_Jump.png" id="1_mud5u"]
[ext_resource type="Texture2D" uid="uid://dkdx22kt5o0m8" path="res://Asset/Sprite/FreeKnight_v1/Colour1/NoOutline/120x80_PNGSheets/_JumpFallInbetween.png" id="2_fvocf"]
[ext_resource type="Texture2D" uid="uid://bsq8vde6s7nl2" path="res://Asset/Sprite/FreeKnight_v1/Colour1/NoOutline/120x80_PNGSheets/_Fall.png" id="3_3pik8"]
[ext_resource type="Texture2D" uid="uid://dwjq3flfusio7" path="res://Asset/Sprite/FreeKnight_v1/Colour1/NoOutline/120x80_PNGSheets/_Run.png" id="3_pmp2f"]
[ext_resource type="Texture2D" uid="uid://cxjjepb1im3f3" path="res://Asset/Sprite/FreeKnight_v1/Colour1/NoOutline/120x80_PNGSheets/_CrouchWalk.png" id="5_pmp2f"]
[ext_resource type="Shape2D" uid="uid://cnx7q47tm41kl" path="res://Resources/Knight_stand_clollision.tres" id="8_adgam"]

[sub_resource type="GDScript" id="GDScript_6l3be"]
script/source = "extends CharacterBody2D

@export var Speed = 150
@export var gravity = 30
@export var jump_force = 300

@onready var ap = $AnimatedSprite2D
@onready var cshape = $CollisionShape2D
@onready var Crouch_RayCast_1 = $RayCast_Crouch_1
@onready var Crouch_RayCast_2 = $RayCast_Crouch_1

var is_crouching = false
var stuck_under_object = false

var standing_cshape = preload(\"res://Resources/Knight_stand_clollision.tres\")
var crouching_cshape = preload(\"res://Resources/Knight_Crouching_Collision.tres\")

func _physics_process(delta) :
	if !is_on_floor():
		velocity.y += gravity
		if velocity.y > 1000 :
			velocity.y = 1000
			
	if Input.is_action_just_pressed(\"Jump\"):
		velocity.y = -jump_force
		
	var horizontal_direction = Input.get_axis(\"Move_Left\" , \"Move_Right\")
	velocity.x = Speed * horizontal_direction
	
	if horizontal_direction != 0 :
		switch_direction(horizontal_direction)
		
	if Input.is_action_just_pressed(\"Crouch\") :
		crouch()
	elif Input.is_action_just_released(\"Crouch\") :
		if above_head_is_empty():
			standing()
		else:
			if stuck_under_object != true :
				stuck_under_object = true
				
	if stuck_under_object && above_head_is_empty():
		if !Input.is_action_just_pressed(\"Crouch\"):
			standing()
			stuck_under_object = false
		
	move_and_slide()
	
	player_animation(horizontal_direction)
	
func above_head_is_empty() -> bool :
	var result = !Crouch_RayCast_1.is_colliding() && !Crouch_RayCast_2.is_colliding()
	return result

	
func player_animation(horizontal_direction) :
	if is_on_floor():
		if horizontal_direction == 0:
			if is_crouching :
				ap.play(\"Crouch\")
			else :
				ap.play(\"Idle\")
		else :
			if is_crouching :
				ap.play(\"Crouch_walk\")
			else :
				ap.play(\"Run\")
	else :
		if velocity.y < 0 :
			ap.play(\"Jump\")
		elif velocity.y > 0 :
			ap.play(\"Fall\")
			
func switch_direction(horizontal_direction):
	ap.flip_h = (horizontal_direction - 1)
	ap.position.x =horizontal_direction * 4

func crouch():
	if is_crouching :
		return
	is_crouching = true
	cshape.shape = crouching_cshape
	cshape.position.y = -12 # Sesuaikan offset crouch


func standing ():
	if is_crouching == false :
		return
	is_crouching = false
	cshape.shape = standing_cshape
	cshape.position.y = -16 # Offset normal berdiri
"

[sub_resource type="AtlasTexture" id="AtlasTexture_55jmu"]
atlas = ExtResource("1_fvocf")
region = Rect2(0, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_mymiu"]
atlas = ExtResource("5_pmp2f")
region = Rect2(0, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_7yuuv"]
atlas = ExtResource("5_pmp2f")
region = Rect2(120, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_2mnku"]
atlas = ExtResource("5_pmp2f")
region = Rect2(240, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_xqgwv"]
atlas = ExtResource("5_pmp2f")
region = Rect2(360, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_nv12e"]
atlas = ExtResource("5_pmp2f")
region = Rect2(480, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_ptfir"]
atlas = ExtResource("5_pmp2f")
region = Rect2(600, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_7l8l3"]
atlas = ExtResource("5_pmp2f")
region = Rect2(720, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_to1tm"]
atlas = ExtResource("5_pmp2f")
region = Rect2(840, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_omam2"]
atlas = ExtResource("3_3pik8")
region = Rect2(0, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_rur5f"]
atlas = ExtResource("3_3pik8")
region = Rect2(120, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_6au7j"]
atlas = ExtResource("3_3pik8")
region = Rect2(240, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_3eeal"]
atlas = ExtResource("1_6l3be")
region = Rect2(0, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_jvxg0"]
atlas = ExtResource("1_6l3be")
region = Rect2(120, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_mud5u"]
atlas = ExtResource("1_6l3be")
region = Rect2(240, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_fvocf"]
atlas = ExtResource("1_6l3be")
region = Rect2(360, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_pmp2f"]
atlas = ExtResource("1_6l3be")
region = Rect2(480, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_3pik8"]
atlas = ExtResource("1_6l3be")
region = Rect2(600, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_adgam"]
atlas = ExtResource("1_6l3be")
region = Rect2(720, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_g1hv4"]
atlas = ExtResource("1_6l3be")
region = Rect2(840, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_liw1m"]
atlas = ExtResource("1_6l3be")
region = Rect2(960, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_jriwm"]
atlas = ExtResource("1_6l3be")
region = Rect2(1080, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_7dww1"]
atlas = ExtResource("1_mud5u")
region = Rect2(0, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_inyuv"]
atlas = ExtResource("1_mud5u")
region = Rect2(120, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_6q824"]
atlas = ExtResource("1_mud5u")
region = Rect2(240, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_c7h21"]
atlas = ExtResource("2_fvocf")
region = Rect2(0, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_eol6p"]
atlas = ExtResource("2_fvocf")
region = Rect2(120, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_q3xbo"]
atlas = ExtResource("3_pmp2f")
region = Rect2(0, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_parcb"]
atlas = ExtResource("3_pmp2f")
region = Rect2(120, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_4b564"]
atlas = ExtResource("3_pmp2f")
region = Rect2(240, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_g743h"]
atlas = ExtResource("3_pmp2f")
region = Rect2(360, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_wd545"]
atlas = ExtResource("3_pmp2f")
region = Rect2(480, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_e3d6m"]
atlas = ExtResource("3_pmp2f")
region = Rect2(600, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_oi07u"]
atlas = ExtResource("3_pmp2f")
region = Rect2(720, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_3su45"]
atlas = ExtResource("3_pmp2f")
region = Rect2(840, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_lbaqs"]
atlas = ExtResource("3_pmp2f")
region = Rect2(960, 0, 120, 80)

[sub_resource type="AtlasTexture" id="AtlasTexture_ds1xm"]
atlas = ExtResource("3_pmp2f")
region = Rect2(1080, 0, 120, 80)

[sub_resource type="SpriteFrames" id="SpriteFrames_7dww1"]
animations = [{
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_55jmu")
}],
"loop": true,
"name": &"Crouch",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_mymiu")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7yuuv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_2mnku")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_xqgwv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_nv12e")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ptfir")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_7l8l3")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_to1tm")
}],
"loop": true,
"name": &"Crouch_walk",
"speed": 5.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_omam2")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_rur5f")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6au7j")
}],
"loop": true,
"name": &"Fall",
"speed": 7.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_3eeal")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_jvxg0")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_mud5u")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_fvocf")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_pmp2f")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3pik8")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_adgam")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_g1hv4")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_liw1m")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_jriwm")
}],
"loop": true,
"name": &"Idle",
"speed": 10.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_7dww1")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_inyuv")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_6q824")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_c7h21")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_eol6p")
}],
"loop": true,
"name": &"Jump",
"speed": 6.0
}, {
"frames": [{
"duration": 1.0,
"texture": SubResource("AtlasTexture_q3xbo")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_parcb")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_4b564")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_g743h")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_wd545")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_e3d6m")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_oi07u")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_3su45")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_lbaqs")
}, {
"duration": 1.0,
"texture": SubResource("AtlasTexture_ds1xm")
}],
"loop": true,
"name": &"Run",
"speed": 10.0
}]

[node name="CharacterBody2D" type="CharacterBody2D"]
script = SubResource("GDScript_6l3be")

[node name="AnimatedSprite2D" type="AnimatedSprite2D" parent="."]
position = Vector2(4, -35.625)
scale = Vector2(0.83333343, 0.8906252)
sprite_frames = SubResource("SpriteFrames_7dww1")
animation = &"Crouch"
autoplay = "Idle"
frame_progress = 0.5926814

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(0, -16)
shape = ExtResource("8_adgam")

[node name="RayCast_Crouch_1" type="RayCast2D" parent="."]
position = Vector2(-7, -8)
target_position = Vector2(0, -25)

[node name="RayCast_Crouch_2" type="RayCast2D" parent="."]
position = Vector2(7, -8)
target_position = Vector2(0, -25)
